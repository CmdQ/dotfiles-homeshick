#!/usr/bin/bash
set -e -u

dnd_mode () {
	if [[ "$1" == true ]]; then
		echo DND mode is now OFF \(i. e. show notifications: "$1"\)
	else
		echo DND mode is now ON  \(i. e. show notifications: "$1"\)
	fi
}

QUIET=0
STATUS=0
TARGET=unknown
while getopts "deqsh" options; do
	case "$options" in
		q) # quiet, do not produce output
			QUIET=1
			;;
		e) # enable DND mode
			TARGET=false
			;;
		d) # disable DND mode
			TARGET=true
			;;
		s) # query DND status (combine with -q for exit code 0 iff DND)
			STATUS=1
			;;
		h)
			;&
		*)
			echo A script to enable/disable/toggle/query Gnome\'s notification setting.
			echo
			echo USAGE:
			echo    $(basename "$0") [FLAGS]
			echo
			echo FLAGS:
			sed -nE 's/^\s+(\w)\) #/   -\1/p' $0
			exit 0
			;;
	esac
done

BEFORE=$(gsettings get org.gnome.desktop.notifications show-banners)

if ((STATUS)); then
	if ((QUIET)); then
		if [[ "$BEFORE" == true ]]; then
			exit 1
		else
			exit 0
		fi
	else
		dnd_mode "$BEFORE"
		exit 0
	fi
fi

if [[  $TARGET == unknown ]]; then
	if [[ "$BEFORE" == true ]]; then
		TARGET=false
	else
		TARGET=true
	fi
fi

gsettings set org.gnome.desktop.notifications show-banners "$TARGET"
if (( !QUIET )); then
	dnd_mode "$TARGET"
fi
